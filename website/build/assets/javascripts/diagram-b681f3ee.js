function link(t,e,i,n){var r=new joint.shapes.fsa.Arrow({source:{id:t.id},target:{id:e.id},labels:[{position:.5,attrs:{text:{text:i||"","font-weight":"bold"}}}],vertices:n||[]});return graph.addCell(r),r}function getJqueryElement(t){return $("[model-id='"+t+"']")}function arrowSourceHidden(t){link=getJqueryElement(t),link.find(".marker-arrowhead-group.marker-arrowhead-group-source").attr("class","marker-arrowhead-group marker-arrowhead-group-source sourceHidden")}function popover_close_other_popovers_handler(t){t.stopPropagation(),t.preventDefault(),$('[data-toggle="popover"]').not(this).popover("hide")}var erd=joint.shapes.erd,graph=new joint.dia.Graph,paper=new joint.dia.Paper({el:document.getElementById("paper"),width:1e3,height:600,gridSize:1,model:graph,linkPinning:!1,interactive:!1,linkConnectionPoint:joint.util.shapePerimeterConnectionPoint}),highlighter=V("path",{stroke:"#e9fc03","stroke-width":"2px",fill:"transparent","pointer-events":"none"});erd.Attribute.prototype.getHighlighterPath=function(t,e){return["M",0,e/2,"A",t/2,e/2,"0 1,0",t,e/2,"A",t/2,e/2,"0 1,0",0,e/2].join(" ")},erd.Entity.prototype.getHighlighterPath=function(t,e){return["M",t,0,t,e,0,e,0,0,"z"].join(" ")},erd.Relationship.prototype.getHighlighterPath=function(t,e){return["M",t/2,0,t,t/2,t/2,t,0,t/2,"z"].join(" ")},erd.ISA.prototype.getHighlighterPath=function(t,e){return["M",-8,1,t+8,1,t/2,e+2,"z"].join(" ")},paper.off("cell:highlight cell:unhighlight"),paper.on("cell:highlight",function(t){var e=5,i=g.rect(t.getBBox({useModelGeometry:!0})).moveAndExpand({x:-e,y:-e,width:2*e,height:2*e});highlighter.translate(i.x,i.y,{absolute:!0}),highlighter.attr("d",t.model.getHighlighterPath(i.width,i.height)),V(paper.viewport).append(highlighter)}),paper.on("cell:unhighlight",function(){highlighter.remove()});var wage=new erd.WeakEntity({position:{x:530,y:200},attrs:{text:{fill:"#ffffff",text:"Wage","letter-spacing":0,style:{"text-shadow":"1px 0 1px #333333"}},".inner":{fill:"#31d0c6",stroke:"none",points:"155,5 155,55 5,55 5,5"},".outer":{fill:"none",stroke:"#31d0c6",points:"160,0 160,60 0,60 0,0",filter:{name:"dropShadow",args:{dx:.5,dy:2,blur:2,color:"#333333"}}}}}),isa=new erd.ISA({position:{x:125,y:300},attrs:{text:{text:"ISA",fill:"#ffffff","letter-spacing":0,style:{"text-shadow":"1px 0 1px #333333"}},polygon:{fill:"#fdb664",stroke:"none",filter:{name:"dropShadow",args:{dx:0,dy:2,blur:1,color:"#333333"}}}}}),number=new erd.Key({position:{x:1,y:90},attrs:{text:{fill:"#ffffff",text:"Number","letter-spacing":0,"text-decoration":"",style:{"text-shadow":"1px 0 1px #333333"}},".outer, .inner":{fill:"#226ca9",stroke:"none"},".outer":{filter:{name:"dropShadow",args:{dx:0,dy:2,blur:2,color:"#222138"}}}}}),bigServices=new erd.Entity({position:{x:100,y:200},attrs:{text:{fill:"#ffffff",text:"Employee","letter-spacing":0,style:{"text-shadow":"1px 0 1px #333333"}},".outer, .inner":{fill:"#226ca9",stroke:"none",filter:{name:"dropShadow",args:{dx:.5,dy:2,blur:2,color:"#333333"}}}}}),service=new erd.Relationship({position:{x:300,y:390},attrs:{text:{fill:"#ffffff",text:"Service","letter-spacing":0,style:{"text-shadow":"1px 0 1px #333333"}},".outer":{fill:"#226ca9",stroke:"none",filter:{name:"dropShadow",args:{dx:0,dy:2,blur:1,color:"#333333"}}}}}),serviceRetirement=new erd.Relationship({position:{x:300,y:390},attrs:{text:{fill:"#ffffff",text:"Service","letter-spacing":0,style:{"text-shadow":"1px 0 1px #333333"}},".outer":{fill:"#226ca9",stroke:"#ff0000","stroke-dasharray":"3,1",filter:{name:"dropShadow",args:{dx:0,dy:2,blur:2,color:"#222138"}}}}}),group=new erd.Entity({position:{x:500,y:90},size:{width:200,height:200},attrs:{text:{fill:"#000000",text:"Project Example","letter-spacing":0,"y-alignment":-120},".outer, .inner":{fill:"#e6e6e6",stroke:"none",filter:{name:"dropShadow",args:{dx:0,dy:1,blur:1,color:"#333333"}}}}}),broker=new erd.IdentifyingRelationship({position:{x:550,y:400},attrs:{text:{fill:"#ffffff",text:"MQTT \nBroker","letter-spacing":0,style:{"text-shadow":"1px 0 1px #333333"}},".inner":{fill:"#226ca9",stroke:"none"},".outer":{fill:"none",stroke:"#226ca9",filter:{name:"dropShadow",args:{dx:0,dy:2,blur:1,color:"#333333"}}}}}),lyra=bigServices.clone().position(300,125).attr("text/text","Lyra \n(automation service)"),arcApi=bigServices.clone().position(300,300).attr("text/text","Arc API"),elektra=number.clone().position(5,200).attr("text/text","Elektra"),elektraCli=number.clone().position(5,275).attr("text/text","Elektra Cli"),lyraCli=number.clone().position(75,375).attr("text/text","Lyra Cli"),swiftService=service.clone().position(800,145).attr("text/text","SWIFT"),reverseProxy=service.clone().position(800,5).attr("text/text","Reverse \nProxy"),node1=number.clone().position(510,105).attr("text/text","Arc Node 1"),node2=number.clone().position(580,220).attr("text/text","Arc Node 2"),createLink=function(t,e){var i=new erd.Line({source:{id:t.id},target:{id:e.id}});return i.addTo(graph)},createLabel=function(t){return{labels:[{position:-20,attrs:{text:{dy:-8,text:t,fill:"#ffffff"},rect:{fill:"none"}}}]}};graph.addCells([elektra,lyraCli,lyra,arcApi,broker,swiftService,reverseProxy,group,node1,node2]),elektraToLyra=createLink(elektra,lyra),elektraToArcApi=createLink(elektra,arcApi),cliToLyra=createLink(lyraCli,lyra),cliToArcApi=createLink(lyraCli,arcApi),lyraToArcApi=createLink(lyra,arcApi),arcApiToBroker=createLink(arcApi,broker),node1ToProxy=link(node1,reverseProxy,"auto updates"),node2ToProxy=link(node2,reverseProxy,"auto updates"),node1ToBroker=createLink(node1,broker),node2ToBroker=createLink(node2,broker),node1ToArcApi=link(node1,arcApi,"bootstrap"),node2ToArcApi=link(node2,arcApi,"bootstrap"),siwftToProxy=createLink(reverseProxy,swiftService),$(function(){arrowSourceHidden(elektraToLyra.id),arrowSourceHidden(elektraToArcApi.id),arrowSourceHidden(cliToLyra.id),arrowSourceHidden(cliToArcApi.id),arrowSourceHidden(lyraToArcApi.id),arrowSourceHidden(node1ToProxy.id),arrowSourceHidden(node2ToProxy.id),arrowSourceHidden(node1ToArcApi.id),arrowSourceHidden(node2ToArcApi.id),arrowSourceHidden(siwftToProxy.id),$("g.fsa.Arrow.link").each(function(){orig_classes=$(this).attr("class"),$(this).attr("class",orig_classes+" joint-link"),$(this).find(".connection-wrap").remove()}),getJqueryElement(elektra.id).popover({title:"Elektra Details",content:$("#elektra_popover_content").html(),html:!0,container:"#popover_container"}),getJqueryElement(elektra.id).attr("data-toggle","popover"),getJqueryElement(lyraCli.id).popover({title:"Lyra Cli Details",content:$("#lyra_cli_popover_content").html(),html:!0,container:"#popover_container"}),getJqueryElement(lyraCli.id).attr("data-toggle","popover"),getJqueryElement(lyra.id).popover({title:"Lyra Details",content:$("#lyra_popover_content").html(),html:!0,container:"#popover_container"}),getJqueryElement(lyra.id).attr("data-toggle","popover"),getJqueryElement(arcApi.id).popover({title:"Arc API Details",content:$("#arc_api_popover_content").html(),html:!0,container:"#popover_container"}),getJqueryElement(arcApi.id).attr("data-toggle","popover"),getJqueryElement(broker.id).popover({title:"Broker Details",content:$("#broker_popover_content").html(),html:!0,container:"#popover_container"}),getJqueryElement(broker.id).attr("data-toggle","popover"),getJqueryElement(swiftService.id).popover({title:"SWIFT Details",content:$("#swift_popover_content").html(),html:!0,container:"#popover_container"}),getJqueryElement(swiftService.id).attr("data-toggle","popover"),getJqueryElement(reverseProxy.id).popover({title:"Reverse Proxy Details",content:$("#reverse_proxy_popover_content").html(),html:!0,container:"#popover_container"}),getJqueryElement(reverseProxy.id).attr("data-toggle","popover"),$('[data-toggle="popover"]').on("click",popover_close_other_popovers_handler),$('[data-toggle="popover"]').on("shown.bs.popover",function(){$(".jsPopoverDetail").initPopoverDetail()})});